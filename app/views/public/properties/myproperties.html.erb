<div class="container">
  <div class="d-grid gap-2 col-5 mx-auto text-center">
    <h2>取り扱い物件一覧</h2>
  </div>
<br>
<br>
  <div class="d-grid gap-2 col-4 mx-auto text-center">
  <button type="button" class="btn btn-info btn-lg btn-block" data-toggle="collapse" data-target="#search">
    <i class="fa-solid fa-magnifying-glass"></i> 物件を検索する
    </button>
  </div>
  <div id="search" class="collapse">
  <br>
  <%= search_form_for @q, url: properties_myproperties_path do |f| %>
    <div class="form-group row h5">
      <div class="col-sm-3">
      </div>
      <div class="col-sm-2">
        <%= f.label :id_eq, "物件ID" %>
      </div>
      <div class="col-sm-4">
        <%= f.search_field :id_eq , class: "form-control", style: "width:60%" %>
      </div>
    </div>
    <div class="form-group row h5">
      <div class="col-sm-3">
      </div>
      <div class="col-sm-2">
        <%= f.label :prefecture_eq, "都道府県" %>
      </div>
      <div class="col-sm-4">
        <%= f.select :prefecture_eq, Property.prefectures, {include_blank: '選択'},  {class: 'form-select'} %>
      </div>
    </div>
    <div class="form-group row h5">
      <div class="col-sm-3">
      </div>
      <div class="col-sm-2">
        <%= f.label :municipality_cont, "市区町村" %>
      </div>
      <div class="col-sm-4">
        <%= f.search_field :municipality_cont, class: "form-control", style: "width:60%" %>
      </div>
    </div>
    <div class="form-group row h5">
      <div class="col-sm-3">
      </div>
      <div class="col-sm-2">
        <%= f.label :kind_eq, "物件種別" %>
      </div>
      <div class="col-sm-4">
        <%= f.select :kind_eq, Property.kinds, {include_blank: '選択'},  {class: 'form-select'} %>
      </div>
    </div>
    <div class="form-group row h5">
      <div class="col-sm-3">
      </div>
      <div class="col-sm-2">
        <%= f.label :sell_category_eq, "売却カテゴリ" %>
      </div>
      <div class="col-sm-4">
        <%= f.select :sell_category_eq, Property.sell_categories, {include_blank: '選択'},  {class: 'form-select'} %>
      </div>
    </div>
    <div class="form-group row h5">
      <div class="col-sm-3">
      </div>
      <div class="col-sm-2">
        <%= f.label :right_eq, "権利種別" %>
      </div>
      <div class="col-sm-4">
        <%= f.select :right_eq, Property.rights, {include_blank: '選択'},  {class: 'form-select'} %>
      </div>
    </div>
    <div class="form-group row h5">
      <div class="col-sm-3">
      </div>
      <div class="col-sm-2">
        <%= f.label :line_cont, "路線" %>
      </div>
      <div class="col-sm-4">
        <%= f.search_field :line_cont, class: "form-control" , style: "width:60%" %>
      </div>
    </div>
    <div class="form-group row h5">
      <div class="col-sm-3">
      </div>
      <div class="col-sm-2">
        <%= f.label :station_cont, "駅名" %>
      </div>
      <div class="col-sm-4">
        <%= f.search_field :station_cont, class: "form-control", style: "width:60%" %>
      </div>
    </div>
    <div class="form-group row h5">
      <div class="col-sm-3">
      </div>
      <div class="col-sm-2">
        <%= f.label :walking_minute, "徒歩" %>
      </div>
      <div class="col-sm-2">
        <%= f.number_field :walking_minute_gteq, class: "form-control", style: "width:60%" ,min:1%>
        <p class="align-middle">分〜</p>
      </div>
      <div class="col-sm-2">
        <%= f.number_field :walking_minute_lteq, class: "form-control", style: "width:60%" ,min:1 %>
        <p class="align-middle">分以内</p>
      </div>
    </div>
    <div class="form-group row h5">
      <div class="col-sm-3">
      </div>
      <div class="col-sm-2">
        <%= f.label :price, "価格" %>
      </div>
      <div class="col-sm-3">
        <%= f.number_field :price_gteq, class: "form-control", style: "width:60%" ,min:0 %>
        <p class="align-middle">万円〜</p>
      </div>
      <div class="col-sm-3">
        <%= f.number_field :price_lteq, class: "form-control", style: "width:60%" ,min:0 %>
        <p class="align-middle">万円以下</p>
      </div>
    </div>
    <div class="form-group row h5">
      <div class="col-sm-3">
      </div>
      <div class="col-sm-2">
        <%= f.label :building_coverage_ratio, "建ぺい率" %>
      </div>
      <div class="col-sm-3">
        <%= f.number_field :building_coverage_ratio_gteq, class: "form-control", style: "width:50%" ,min:0 %>
        <p class="align-middle">％〜</p>
      </div>
      <div class="col-sm-3">
        <%= f.number_field :building_coverage_ratio_lteq, class: "form-control", style: "width:50%" ,min:0 %>
        <p class="align-middle">％以下</p>
      </div>
    </div>
    <div class="form-group row h5">
      <div class="col-sm-3">
      </div>
      <div class="col-sm-2">
        <%= f.label :floor_area_ratio, "容積率" %>
      </div>
      <div class="col-sm-3">
        <%= f.number_field :floor_area_ratio_gteq, class: "form-control", style: "width:50%" ,min:0 %>
        <p class="align-middle">％〜</p>
      </div>
      <div class="col-sm-3">
        <%= f.number_field :floor_area_ratio_lteq, class: "form-control", style: "width:50%" ,min:0 %>
        <p class="align-middle">％以下</p>
      </div>
    </div>
    <div class="form-group row h5">
      <div class="col-sm-3">
      </div>
      <div class="col-sm-2">
        <%= f.label :use_area_cont, "用途地域" %>
      </div>
      <div class="col-sm-4">
        <%= f.search_field :use_area_cont, class: "form-control" %>
      </div>
    </div>
  <br>
    <div class="row justify-content-center">
      <div class="col-sm-3">
        <%= button_tag type: "submit", class: "btn btn-success text-light btn-lg btn-block" do %>
        <i class="fa-solid fa-magnifying-glass"></i>　検索する
        <% end %>
      </div>
    </div>
  <% end %>
  </div>
<br>
<br>
  <table class="table table-bordered">
    <thead class="h5 table-secondary text-center">
      <tr>
        <th style="width: 8%">物件ID</th>
        <th style="width: 14%">物件画像</th>
        <th style="width: 64%">概要</th>
        <th style="width: 24%">閲覧申請</th>
      </tr>
    </thead>
    <tbody>
      <% @properties.each do |property| %>
        <% view_applications = property.view_applications %>
      <tr class="h5 text-center">
        <td class="align-middle text-center"><%= property.id %></td>
        <td class="align-middle text-center">
          <% if property.image.attached? %>
            <%= image_tag property.image, size: "100x100" %>
          <% else %>
            <%= image_tag 'default-image.jpg', size: "100x100" %>
          <% end %>
        </td>
        <td class="align-middle text-center">
          <%= link_to property_path(current_user) do %>
            <%= property.sell_category %>&emsp;
            <%= property.prefecture %>
            <%= property.municipality %>
            <%= property.city_block %>&emsp;
            <%= property.kind %>&emsp;<br>
            <%= property.line %>線&emsp;
            <%= property.station %>駅&emsp;
            徒歩<%= property.walking_minute %>分<br>
            <%= property.price %>万円&emsp;
            <% if property.kind == "土地" %>
              土地面積：<%= property.land_area %>㎡&emsp;
            <% else %>
              土地面積：<%= property.land_area %>㎡&emsp;
              建物面積：<%= property.building_area %>㎡&emsp;
            <% end %>
            <%= property.right %>&emsp;<br>
            <%= property.use_area %>&emsp;
            建ぺい率<%= property.building_coverage_ratio %>％&emsp;
            容積率<%= property.floor_area_ratio %>％
          <% end %>
        </td>
        <td class="align-middle text-center">
          <% if view_applications.any? {|view_application| view_application.apply_status == "申請中" || view_application.apply_status == "許可"} %>
            <%= link_to property_view_applications_path(property), class: "btn btn-warning text-light btn-block font-weight-bold", "data-confirm" => "申請を確認しますか？" do %>
            <i class="fa-solid fa-flag text-danger"></i> 申請あり
            <% end %>
          <% else %>
            申請なし
          <% end %>
        </td>
      </tr>
      <% end %>
    </tbody>
  </table>
<%= paginate @properties %>
<br>
<br>
  <div class="row justify-content-center">
    <div class="col-sm-3">
      <%= link_to  users_mypage_path, class: "btn btn-secondary text-light btn-lg" do %>
      <i class="fa-solid fa-backward-step fa-lg"></i>　マイページへ戻る
      <% end %>
    </div>
  </div>
<br>
<br>
</div>